name: Notifications
on: deployment_status
jobs:
  approval-request:
    runs-on: ubuntu-latest
    if: ${{ github.event.deployment_status.state == 'waiting' && github.event.deployment.environment == 'Production' }}
    steps:
      - name: Request Deployment Approval
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          DISCORD_EMBEDS: |
            [
              {
                "title": "[${{ github.repository }}] Requires Deployment Approval",
                "url": "${{ github.event.deployment_status.target_url }}",
                "description": "${{ github.repository }} requires approval for deployment to production.",
                "color": 15105570
              }
            ]

  failure-notification:
    runs-on: ubuntu-latest
    if: ${{ github.event.deployment_status.state == 'failure' }}
    steps:
      - name: Notify Deployment Failure
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          DISCORD_EMBEDS: |
            [
              {
                "title": "[${{ github.repository }}] ${{ github.event.deployment.environment }} Deployment Failure",
                "url": "${{ github.event.deployment_status.target_url }}",
                "description": "${{ github.repository }} failed to deploy to ${{ github.event.deployment.environment }}.",
                "color": 12720135
              }
            ]
